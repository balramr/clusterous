name: ipython-spark
cluster:
  docker:
    type: $docker_instance_type
    count: $docker_instance_count
  spark:
    type: $spark_instance_type
    count: $spark_instance_count
environment:
  copy:
    - "files/"
    - "image/"
  image:
    - dockerfile: "image/python_http/"
      image_name: "bdkd:python_http_v2"
    - dockerfile: "image/ipython_mesos/"
      image_name: "bdkd:ipython_mesos_v2"
  components:
    http:
      machine: docker
      cpu: auto
      image: "registry:5000/bdkd:python_http_v2"
      cmd: "/bin/bash /home/data/files/launch_http.sh"
      ports: "8881:8881"
      
    notebook:
      machine: docker
      cpu: auto
      image: "registry:5000/bdkd:ipython_mesos_v2"
      cmd: "/bin/bash /home/data/files/launch_ipython.sh"
      docker_network: host

  expose_tunnel:
    - service: 8881:http:8881
      message: "HTTP service: {url}"
    - service: 31888:notebook:31888
      message: "IPython notebook: {url} (It may take some time to be available)"
